<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用Fis3自动构建前端项目快速上手 · wah's life</title><meta name="description" content="fis3配置快速开始指南，实现编译SASS(SCSS)，压缩JS、CSS、图片，PC端合雪碧图，移动端自动转换REM值，开发时浏览器自动同步的功能，一份代码编译适应多个环境等功能，满足日产活动项目的需求。
1. 安装node.js环境2. 由于npm网速不理想， 建议安装cnpm， 详细方法：https://npm.taobao.org/
a.打开命令行（开始菜单搜索cmd）, 输入：1npm install -g cnpm --registry=https://regist"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/utakata.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/author.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="http://weibo.com/shihuacivis" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="http://shihuacivis.lofter.com" target="_blank" class="nav-list-link">LOFTER</a></li><li class="nav-list-item"><a href="https://github.com/shihuacivis" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用Fis3自动构建前端项目快速上手</h1><div class="post-meta"><div class="post-time">Jun 28, 2016</div></div><div class="post-content"><p>fis3配置快速开始指南，实现编译SASS(SCSS)，压缩JS、CSS、图片，PC端合雪碧图，移动端自动转换REM值，开发时浏览器自动同步的功能，一份代码编译适应多个环境等功能，满足日产活动项目的需求。<br><a id="more"></a></p>
<h3 id="1-_安装node-js环境">1. 安装node.js环境</h3><h3 id="2-_由于npm网速不理想，_建议安装cnpm，_详细方法：https://npm-taobao-org/">2. 由于npm网速不理想， 建议安装cnpm， 详细方法：<a href="https://npm.taobao.org/" target="_blank" rel="external">https://npm.taobao.org/</a></h3><blockquote>
<p>a.打开命令行（开始菜单搜索cmd）, 输入：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>b.安装完成后以后npm的指令可以用cnpm代替执行</p>
</blockquote>
<h3 id="3-_安装fis3，安装方法：_http://fis-baidu-com/fis3/docs/beginning/install-html">3. 安装fis3，安装方法： <a href="http://fis.baidu.com/fis3/docs/beginning/install.html" target="_blank" rel="external">http://fis.baidu.com/fis3/docs/beginning/install.html</a></h3><blockquote>
<p>a. 安装fis3环境， 命令行执行：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g fis3</span><br></pre></td></tr></table></figure></p>
<p>b. 由于fis3抽风般的默认使用绝对路径，所以需要安装相对路径插件fis3-hook-relative，命令行执行：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g fis3-hook-relative</span><br></pre></td></tr></table></figure></p>
<p>c. 选装sass/less编译环境，推荐使用sass环境，命令行执行：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g fis-parser-node-sass</span><br></pre></td></tr></table></figure></p>
<p>d. 安装px2rem插件，以后在css文件中只需要按设计稿上的px值1:1编码。命令行执行：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g fis-postprocessor-px2<span class="comment">rem</span></span><br></pre></td></tr></table></figure></p>
<p>e. 安装文件合并插件，命令行执行：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g fis3-postpackager-loader</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="4-_fis-conf-js配置">4. fis-conf.js配置</h3><p>项目一般我们的项目分为pc端和移动端两种，因此fis分两种配置，在PC端上，当我们打包正式包时，会自动合成雪碧图，而在移动端上则不会合图，但会自动将css的px转成rem以实现自适应布局。若有特殊项目则可以自行修改配置文件fis-conf.js。</p>
<ul>
<li><p>PC端fis-conf.js配置<br>目前发现雪碧图插件和文件合并插件不能同时使用，所有选择开启优化效果更明显的雪碧图插件，暂时放弃文件自动合并插件。<br>包含以下功能：编译SASS(SCSS)，压缩JS、CSS、图片，合雪碧图。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PC端项目 通用配置</span></span><br><span class="line"><span class="comment">// 测试包配置 执行 fis3 release test</span></span><br><span class="line"><span class="keyword">var</span> TEST_OUTPUT_PATH = <span class="string">'./test'</span>; <span class="comment">// 测试包路径 （仅执行编译，不压缩）</span></span><br><span class="line"><span class="keyword">var</span> TEST_USE_HASH = <span class="literal">false</span>; <span class="comment">// 是否使用文件指纹 （随机改变文件名避免浏览器缓存）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正式包配置 执行 fis3 release dist</span></span><br><span class="line"><span class="keyword">var</span> FORMAL_OUTPUT_PATH = <span class="string">'./dist'</span>; <span class="comment">// 正式打包路径（包含编译、压缩代码 、图片压缩、csssprite）</span></span><br><span class="line"><span class="keyword">var</span> FORMAL_USE_HASH = <span class="literal">false</span>; <span class="comment">// 是否使用文件指纹 （随机改变文件名避免浏览器缓存）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常规设置 基本不用动</span></span><br><span class="line">fis.set(<span class="string">'project.files'</span>, [<span class="string">'src/**'</span>]);</span><br><span class="line">fis.set(<span class="string">'project.ignore'</span>, [<span class="string">'node_modules/**'</span>, <span class="string">'dist/**'</span>, <span class="string">'README.md'</span> , <span class="string">'local/**'</span> , <span class="string">'.git/**'</span>, <span class="string">'fis-conf.js'</span>]);</span><br><span class="line">fis.set(<span class="string">'charset'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line">fis.set(<span class="string">'project.charset'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// less 编译插件 fis-parser-less</span></span><br><span class="line"><span class="comment">// fis.match('**.less', &#123;</span></span><br><span class="line"><span class="comment">//     parser: fis.plugin('less'),</span></span><br><span class="line"><span class="comment">//     rExt: '.css'</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// fis.match(/^\/src\/c\/_.*\.(css|less)/i,&#123;</span></span><br><span class="line"><span class="comment">//   release : false</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sass 编译插件 fis-parser-node-sass</span></span><br><span class="line">fis.match(<span class="string">'*.scss'</span>, &#123;</span><br><span class="line">  rExt: <span class="string">'.css'</span>,</span><br><span class="line">  parser: fis.plugin(<span class="string">'node-sass'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">fis.match(<span class="regexp">/^\/src\/css\/_.*\.(css|scss)/i</span>,&#123;</span><br><span class="line">    release : <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="regexp">/^\/src\/(.*)$/i</span>,&#123;</span><br><span class="line">  release : <span class="string">"$1"</span>,</span><br><span class="line">  useCache : <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用相对路径</span></span><br><span class="line">fis.hook(<span class="string">'relative'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置测试打包 不压缩代码 不合图不压缩</span></span><br><span class="line">fis.media(<span class="string">'test'</span>)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    relative: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;js,css,scss,png,jpg,jpeg,gif,mp3,mp4,flv,swf,svg,eot,ttf,woff&#125;'</span>,&#123;</span><br><span class="line">      useHash: TEST_USE_HASH</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    deploy: fis.plugin(<span class="string">'local-deliver'</span>, &#123;</span><br><span class="line">        to: TEST_OUTPUT_PATH</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置正式打包 包含压缩代码 合图图压缩</span></span><br><span class="line">fis.media(<span class="string">'dist'</span>)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    relative: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;js,css,scss,png,jpg,jpeg,gif,mp3,mp4,flv,swf,svg,eot,ttf,woff&#125;'</span>,&#123;</span><br><span class="line">      useHash: FORMAL_USE_HASH</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**.js'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'uglify-js'</span>,&#123;</span><br><span class="line">      output : &#123;</span><br><span class="line">        ascii_only : <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**.html:js'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'uglify-js'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="regexp">/^\/src\/c\/(.*\.png)$/i</span>,&#123;</span><br><span class="line">    release : <span class="string">"i/spriter/$1"</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.png'</span>, &#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'png-compressor'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;css,scss&#125;'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'clean-css'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**html:css'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'clean-css'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">    spriter: fis.plugin(<span class="string">'csssprites'</span>,&#123;</span><br><span class="line">      layout: <span class="string">'matrix'</span>,</span><br><span class="line">      margin: <span class="string">'0'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// .match('::package', &#123;</span></span><br><span class="line">  <span class="comment">//   postpackager: fis.plugin('loader', &#123;</span></span><br><span class="line">  <span class="comment">//     allInOne: &#123;</span></span><br><span class="line">  <span class="comment">//       js: 'j/auto_aio.js',</span></span><br><span class="line">  <span class="comment">//       css: 'c/auto_aio.css'</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  .match(<span class="string">'*.&#123;css,scss&#125;'</span>,&#123;</span><br><span class="line">    useSprite : <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    deploy: fis.plugin(<span class="string">'local-deliver'</span>, &#123;</span><br><span class="line">      to: FORMAL_OUTPUT_PATH</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>移动端fis-conf.js配置<br>包含以下功能：编译SASS(SCSS)，自动将px单位转为REM单位，压缩JS、CSS、图片，合并JS/CSS文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动端项目 通用配置</span></span><br><span class="line"><span class="comment">// 测试包配置 执行 fis3 release test</span></span><br><span class="line"><span class="keyword">var</span> TEST_OUTPUT_PATH = <span class="string">'./test'</span>; <span class="comment">// 测试包路径 （仅执行编译，不压缩）</span></span><br><span class="line"><span class="keyword">var</span> TEST_USE_HASH = <span class="literal">false</span>; <span class="comment">// 是否使用文件指纹 （随机改变文件名避免浏览器缓存）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正式包配置 执行 fis3 release dist</span></span><br><span class="line"><span class="keyword">var</span> FORMAL_OUTPUT_PATH = <span class="string">'./dist'</span>; <span class="comment">// 正式打包路径（包含编译、压缩代码 、图片压缩、csssprite）</span></span><br><span class="line"><span class="keyword">var</span> FORMAL_USE_HASH = <span class="literal">false</span>; <span class="comment">// 是否使用文件指纹 （随机改变文件名避免浏览器缓存）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动端自适应配置</span></span><br><span class="line"><span class="keyword">var</span> REM_UNIT = <span class="number">100</span>; <span class="comment">// rem的基础单位</span></span><br><span class="line"><span class="keyword">var</span> BASE_DPR = <span class="number">1</span>; <span class="comment">// 通用设备时一般为1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常规设置 基本不用动</span></span><br><span class="line">fis.set(<span class="string">'project.files'</span>, [<span class="string">'src/**'</span>]);</span><br><span class="line">fis.set(<span class="string">'project.ignore'</span>, [<span class="string">'node_modules/**'</span>, <span class="string">'dist/**'</span>, <span class="string">'README.md'</span> , <span class="string">'local/**'</span> , <span class="string">'.git/**'</span>, <span class="string">'fis-conf.js'</span>]);</span><br><span class="line">fis.set(<span class="string">'charset'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line">fis.set(<span class="string">'project.charset'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// less 编译插件 fis-parser-less</span></span><br><span class="line"><span class="comment">// fis.match('**.less', &#123;</span></span><br><span class="line"><span class="comment">//     parser: fis.plugin('less'),</span></span><br><span class="line"><span class="comment">//     rExt: '.css'</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// fis.match(/^\/src\/c\/_.*\.(css|less)/i,&#123;</span></span><br><span class="line"><span class="comment">//   release : false</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sass 编译插件 fis-parser-node-sass</span></span><br><span class="line">fis.match(<span class="string">'*.scss'</span>, &#123;</span><br><span class="line">  rExt: <span class="string">'.css'</span>,</span><br><span class="line">  parser: fis.plugin(<span class="string">'node-sass'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="regexp">/^\/src\/(.*)$/i</span>,&#123;</span><br><span class="line">  release : <span class="string">"$1"</span>,</span><br><span class="line">  useCache : <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'*.&#123;css,scss&#125;'</span>, &#123;</span><br><span class="line">    postprocessor: fis.plugin(<span class="string">'px2rem'</span>, &#123;</span><br><span class="line">      baseDpr: BASE_DPR,             <span class="comment">// base device pixel ratio (default: 2)</span></span><br><span class="line">      remVersion: <span class="literal">true</span>,       <span class="comment">// whether to generate rem version (default: true)</span></span><br><span class="line">      remUnit: REM_UNIT,            <span class="comment">// rem unit value (default: 75)</span></span><br><span class="line">      remPrecision: <span class="number">6</span>         <span class="comment">// rem precision (default: 6)</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用相对路径</span></span><br><span class="line">fis.hook(<span class="string">'relative'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置测试打包 不压缩代码 不合图不压缩</span></span><br><span class="line">fis.media(<span class="string">'test'</span>)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    relative: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;js,css,scss,png,jpg,jpeg,gif,mp3,mp4,flv,swf,svg,eot,ttf,woff&#125;'</span>,&#123;</span><br><span class="line">      useHash: TEST_USE_HASH</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    deploy: fis.plugin(<span class="string">'local-deliver'</span>, &#123;</span><br><span class="line">        to: TEST_OUTPUT_PATH</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置正式打包 包含压缩代码 合图图压缩</span></span><br><span class="line">fis.media(<span class="string">'dist'</span>)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    relative: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;js,css,scss,png,jpg,jpeg,gif,mp3,mp4,flv,swf,svg,eot,ttf,woff&#125;'</span>,&#123;</span><br><span class="line">      useHash: FORMAL_USE_HASH</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**.js'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'uglify-js'</span>,&#123;</span><br><span class="line">      output : &#123;</span><br><span class="line">        ascii_only : <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**.html:js'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'uglify-js'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.png'</span>, &#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'png-compressor'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;css,scss&#125;'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'clean-css'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**html:css'</span>,&#123;</span><br><span class="line">    optimizer: fis.plugin(<span class="string">'clean-css'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'*.&#123;css,scss&#125;'</span>,&#123;</span><br><span class="line">    useSprite : <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">    postpackager: fis.plugin(<span class="string">'loader'</span>, &#123;</span><br><span class="line">      allInOne: &#123;</span><br><span class="line">        js: <span class="string">'j/auto_aio.js'</span>,</span><br><span class="line">        css: <span class="string">'c/auto_aio.css'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .match(<span class="string">'**'</span>, &#123;</span><br><span class="line">    deploy: fis.plugin(<span class="string">'local-deliver'</span>, &#123;</span><br><span class="line">      to: FORMAL_OUTPUT_PATH</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-开始使用">5.开始使用</h3><p>将fis-conf.js拷到项目文件夹下。一般项目文件夹结构如下：<br>    文件目录结构如下：<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">└── 项目名称</span><br><span class="line">    ├── src</span><br><span class="line">    │    ├── h</span><br><span class="line">    │    ├── c</span><br><span class="line">    │    ├── j</span><br><span class="line">    │    ├── i</span><br><span class="line">    │    └── res</span><br><span class="line">    └── fis-conf.js</span><br></pre></td></tr></table></figure></p>
<h3 id="6-_开发时开启浏览器自动同步刷新功能（类似browser-sync）">6. 开发时开启浏览器自动同步刷新功能（类似browser-sync）</h3><blockquote>
<p>a. 在命令行中进入到项目目录下。<br>b. 执行以下命令，然后浏览器会默认自动打开127.0.0.1:8080，若没有则要自行打开。<br>    <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 server <span class="built_in">start</span> -- <span class="built_in">type</span> node</span><br></pre></td></tr></table></figure></p>
<p>c. 命令行执行开启自动同步刷新功能<br>    <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 release -wL</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="7-_编译测试包，当完成项目编码后，可以打测试包，放到线上测试环境中测试，测试包不会压缩代码、合并文件，以方便调试。">7. 编译测试包，当完成项目编码后，可以打测试包，放到线上测试环境中测试，测试包不会压缩代码、合并文件，以方便调试。</h3><blockquote>
<p>a. 在命令行中进入到项目目录下。<br>b. 命令行执行：<br>    <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 release test</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="8-_编译正式包，当测试通过后，可以打正式包，此时就会压缩代码、合并文件。">8. 编译正式包，当测试通过后，可以打正式包，此时就会压缩代码、合并文件。</h3><blockquote>
<p>a. 在命令行中进入到项目目录下。<br>b. 命令行执行：<br>    <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 release dist</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="9-如果在线上遇到强缓存的情况，可以将配置文件中TEST_USE_HASH或FORMAL_USE_HASH置为true，开启文件指纹功能。">9.如果在线上遇到强缓存的情况，可以将配置文件中TEST_USE_HASH或FORMAL_USE_HASH置为true，开启文件指纹功能。</h3><h3 id="10-使用rem自适应布局方案时，需要注意下面几点：">10.使用rem自适应布局方案时，需要注意下面几点：</h3><blockquote>
<p>a. 编写css时，当遇到如1px边框，固定px大小的字体这种不需要使用rem自适应大小的属性时，在属性后面加<code>/*px*/</code>，详情参考<a href="https://github.com/songsiqi/px2rem" target="_blank" rel="external">https://github.com/songsiqi/px2rem</a><br>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.selector</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">150px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">64px</span></span></span>; <span class="comment">/*px*/</span></span><br><span class="line">  <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">28px</span></span></span>; <span class="comment">/*px*/</span></span><br><span class="line">  <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> solid <span class="hexcolor">#ddd</span></span></span>; <span class="comment">/*no*/</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p> b. 请在CSS中加入默认字体大小：(竖屏情况下)<br>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 默认是iphone6 */</span></span><br><span class="line"><span class="tag">html</span><span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">50px</span></span></span>; &#125;</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (max-width:<span class="number">359px</span>) and (orientation:portrait) </span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">46.667px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 常见的安卓机 */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">360px</span>) and (max-width:<span class="number">374px</span>) and (orientation:portrait) </span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">48px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 某些冷门的安卓机 如nexus4 */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">384px</span>) and (max-width:<span class="number">399px</span>) and (orientation:portrait) </span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">51.333px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 某些冷门的安卓机 如nexus6 */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">400px</span>) and (max-width:<span class="number">413px</span>) and (orientation:portrait) </span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">53.333px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* iphone6 plus */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">414px</span>) and (max-width:<span class="number">431px</span>) and (orientation:portrait)</span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">55.2px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 以下是其它设备 */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">432px</span>) and (max-width:<span class="number">479px</span>) and (orientation:portrait)</span>&#123;</span><br><span class="line">    <span class="tag">html</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">57.6px</span></span></span>; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">480px</span>)and (max-width:<span class="number">639px</span>) and (orientation:portrait)</span>&#123;</span><br><span class="line">   <span class="tag">html</span><span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">64px</span></span></span>;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (min-width:<span class="number">640px</span>) and (orientation:portrait)</span>&#123;</span><br><span class="line">   <span class="tag">html</span><span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">85.333px</span></span></span>;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>c. viewport通常设置为1即可。<br>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>d.动态适配rem的值<br> (1) 若项目页面带滚动条，只需要根据宽度进行自适应的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_initRem</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pxUnit = <span class="number">100</span>;     <span class="comment">// 在px2rem中预设rem的值 即 1rem = ? px</span></span><br><span class="line">  <span class="keyword">var</span> designWid = <span class="number">750</span>;  <span class="comment">// 设计稿宽度</span></span><br><span class="line">  <span class="keyword">var</span> winWid = <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">  <span class="keyword">var</span> winHei = <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">  <span class="keyword">var</span> bl = winWid / designWid;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'html'</span>).style.fontSize = (bl * pxUnit) + <span class="string">'px'</span>;</span><br><span class="line">&#125;</span><br><span class="line">_initRem();</span><br></pre></td></tr></table></figure></p>
<p> (2) 若项目是单屏页面，吴滚动条时，还需要根据屏幕的宽高比例进行自适应：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_initRem</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pxUnit = <span class="number">100</span>;     <span class="comment">// 在px2rem中预设rem的值 即 1rem = ? px</span></span><br><span class="line">  <span class="keyword">var</span> designWid = <span class="number">750</span>;  <span class="comment">// 设计稿宽度</span></span><br><span class="line">  <span class="keyword">var</span> designHei = <span class="number">1206</span>; <span class="comment">// 设计稿高度</span></span><br><span class="line">  <span class="keyword">var</span> winWid = <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">  <span class="keyword">var</span> winHei = <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">  <span class="keyword">var</span> bl = winHei / winWid &lt; (designHei / designWid) ? winHei / designHei : winWid / designWid;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'html'</span>).style.fontSize = (bl * pxUnit) + <span class="string">'px'</span>;</span><br><span class="line">&#125;</span><br><span class="line">_initRem();</span><br></pre></td></tr></table></figure></p>
</blockquote>
</div></article></div></section><footer><div class="paginator"><a href="/2016/09/29/20160929_tsSubPub/" class="prev">上一篇</a><a href="/2016/02/23/20160223_wechatVideo/" class="next">下一篇</a></div><div data-thread-key="2016/06/28/20160628_fis3/" data-title="使用Fis3自动构建前端项目快速上手" data-url="http://shiwah.me/2016/06/28/20160628_fis3/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-32"><li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li><li data-toggle="ds-share-icons-more" class="ds-share-icons-more"><a href="javascript:;" class="ds-more">分享到</a></li><li><a href="javascript:;" data-service="weibo" class="ds-weibo">新浪微博</a></li><li><a href="javascript:;" data-service="wechat" class="ds-wechat">微信</a></li><li><a href="javascript:;" data-service="facebook" class="ds-facebook">Facebook</a></li><li><a href="javascript:;" data-service="twitter" class="ds-twitter">Twitter</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/06/28/20160628_fis3/" data-title="使用Fis3自动构建前端项目快速上手" data-url="http://shiwah.me/2016/06/28/20160628_fis3/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"shihuacivis"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?97a139550523c2b9972a6f6f339bb382";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>