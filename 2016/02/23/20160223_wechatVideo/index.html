<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 微信H5中video常见的问题 · shihuacivis' life</title><meta name="description" content="最近帮朋友看了微信H5播放video，实现类似吴亦凡参军H5的效果。在X5引擎中遇到了全屏播放、自动播放等几个问题。
1.视频全屏播放我的思路是用一个宽高均为100%的容器.video-wrap来包住video，再让video的高度等于容器的高度，进而实现全屏。
不过这里遇到了2个问题：

在ios上，微信会默认调用原生的播放器来全屏播放视频，会出现白色的菜单和进度条，影响全屏的体验。
在安卓上，微信会调用X5引擎底层播放器组件来播放视频，容器的z-index属性对其无效。此时也会出现菜单，而且最后还会无耻的出现“推荐视频”一栏…… 据说如果播放的是qq.com域名下的视频则不会碰到这个问题。X5内核视频播放官方问题集

在ios中，我们用webkit-playsinline可以让webview使用H5的video直接播放，而不再出现"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/utakata.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/author.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="http://weibo.com/shihuacivis" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="http://shihuacivis.lofter.com" target="_blank" class="nav-list-link">LOFTER</a></li><li class="nav-list-item"><a href="https://github.com/shihuacivis" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">微信H5中video常见的问题</h1><div class="post-meta"><div class="post-time">Feb 23, 2016</div></div><div class="post-content"><p>最近帮朋友看了微信H5播放video，实现类似吴亦凡参军H5的效果。在X5引擎中遇到了全屏播放、自动播放等几个问题。<br><a id="more"></a></p>
<h2 id="1-视频全屏播放">1.视频全屏播放</h2><p>我的思路是用一个宽高均为100%的容器<code>.video-wrap</code>来包住<code>video</code>，再让<code>video</code>的高度等于容器的高度，进而实现全屏。</p>
<p>不过这里遇到了2个问题：</p>
<ul>
<li>在ios上，微信会默认调用原生的播放器来全屏播放视频，会出现白色的菜单和进度条，影响全屏的体验。</li>
<li>在安卓上，微信会调用X5引擎底层播放器组件来播放视频，容器的z-index属性对其无效。此时也会出现菜单，而且最后还会无耻的出现“推荐视频”一栏…… 据说如果播放的是qq.com域名下的视频则不会碰到这个问题。<a href="http://x5.tencent.com/guide?id=2009" target="_blank" rel="external">X5内核视频播放官方问题集</a></li>
</ul>
<p>在ios中，我们用<code>webkit-playsinline</code>可以让webview使用H5的video直接播放，而不再出现菜单和进度条。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"video-wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">video</span> <span class="attribute">id</span>=<span class="value">"video"</span> <span class="attribute">height</span>=<span class="value">"100%"</span> <span class="attribute">x-webkit-airplay</span>=<span class="value">"true"</span> <span class="attribute">webkit-playsinline</span>=<span class="value">"true"</span> <span class="attribute">preload</span>=<span class="value">"auto"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span> <span class="attribute">src</span>=<span class="value">"res/video.mp4"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.video-wrap</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">2</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="function">url</span>(../images/p2/bg.jpg)</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background-size</span>:<span class="value"> cover</span></span>;</span><br><span class="line">  <span class="comment">/*display: none;*/</span></span><br><span class="line">&#125;</span></span><br><span class="line"><span class="tag">video</span> <span class="rules">&#123; <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">100%</span></span></span>; <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">0</span></span></span>; <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> baseline</span></span>; <span class="rule"><span class="attribute">-webkit-user-select</span>:<span class="value"> none</span></span>; <span class="rule"><span class="attribute">-moz-user-select</span>:<span class="value"> none</span></span>; <span class="rule"><span class="attribute">-ms-user-select</span>:<span class="value"> none</span></span>; <span class="rule"><span class="attribute">user-select</span>:<span class="value"> none</span></span>; <span class="rule"><span class="attribute">outline</span>:<span class="value"> none</span></span>; &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-自动（定时）播放视频">2.自动（定时）播放视频</h2><p>在ios下，我们可以直接调用<code>video</code>的play方法实现视频的播放</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// 原生</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'#video'</span>).play();</span><br><span class="line">  <span class="comment">// jQuery</span></span><br><span class="line">  $(<span class="string">'video'</span>)[<span class="number">0</span>].play();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>但在安卓下，由于X5内核绑架了<code>video</code>标签，而且要求视频首次播放时，必须是由用户亲自点击事件触发的才能播放，所以setTimeout不能调用play方法，并且也不能用js去触发click事件……<a href="http://x5.tencent.com/guide?id=2009" target="_blank" rel="external">X5内核视频播放官方问题集</a><br>解决的办法：<br>A.改成用户点击某个按钮后开始播放。<br>B.在游戏开始按钮时，先播放视频然后马上暂停，等到正式要播放视频时，就可以实现跟ios一样的调用方法了。</p>
<h2 id="3-监听视频播放完毕">3.监听视频播放完毕</h2><p>当视频播放完毕后我们希望它能自动隐藏掉并跳到其他界面。<br>video提供了一个视频播放完毕后的事件<code>ended</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#video'</span>).addEventListener(<span class="string">'ended'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'.video-wrap'</span>).innerHTML(<span class="string">''</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a class="prev"> </a><a href="/2016/01/11/20160111_factoryMode/" class="next">下一篇</a></div><div data-thread-key="2016/02/23/20160223_wechatVideo/" data-title="微信H5中video常见的问题" data-url="http://www.shihua.im/2016/02/23/20160223_wechatVideo/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li><li data-toggle="ds-share-icons-more" class="ds-share-icons-more"><a href="javascript:;" class="ds-more">分享到</a></li><li><a href="javascript:;" data-service="weibo" class="ds-weibo">新浪微博</a></li><li><a href="javascript:;" data-service="douban" class="ds-douban">豆瓣网</a></li><li><a href="javascript:;" data-service="facebook" class="ds-facebook">Facebook</a></li><li><a href="javascript:;" data-service="twitter" class="ds-twitter">Twitter</a></li></ul></div></div><div data-thread-key="2016/02/23/20160223_wechatVideo/" data-title="微信H5中video常见的问题" data-url="http://www.shihua.im/2016/02/23/20160223_wechatVideo/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"shihuacivis"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?97a139550523c2b9972a6f6f339bb382";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>